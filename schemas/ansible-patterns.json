{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/ansible/vscode-ansible/main/schemas/ansible-patterns.json",
  "title": "Ansible Playbook with Host Patterns",
  "description": "JSON schema for Ansible playbooks with intelligent host pattern completions",
  "type": "array",
  "items": {
    "$ref": "#/definitions/play"
  },
  "definitions": {
    "play": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the play"
        },
        "hosts": {
          "description": "Target hosts for this play",
          "$ref": "#/definitions/hostPattern"
        },
        "tasks": {
          "type": "array",
          "description": "List of tasks to execute",
          "items": {
            "$ref": "#/definitions/task"
          }
        },
        "vars": {
          "type": "object",
          "description": "Variables for this play"
        },
        "become": {
          "type": "boolean",
          "description": "Enable privilege escalation"
        },
        "become_user": {
          "type": "string",
          "description": "User to become"
        },
        "gather_facts": {
          "type": "boolean",
          "description": "Whether to gather facts"
        },
        "handlers": {
          "type": "array",
          "description": "List of handlers",
          "items": {
            "$ref": "#/definitions/task"
          }
        },
        "pre_tasks": {
          "type": "array",
          "description": "Tasks to run before main tasks",
          "items": {
            "$ref": "#/definitions/task"
          }
        },
        "post_tasks": {
          "type": "array",
          "description": "Tasks to run after main tasks",
          "items": {
            "$ref": "#/definitions/task"
          }
        },
        "roles": {
          "type": "array",
          "description": "List of roles to apply",
          "items": {
            "oneOf": [
              {
                "type": "string",
                "description": "Role name"
              },
              {
                "type": "object",
                "properties": {
                  "role": {
                    "type": "string",
                    "description": "Role name"
                  },
                  "vars": {
                    "type": "object",
                    "description": "Role variables"
                  }
                }
              }
            ]
          }
        }
      },
      "required": ["hosts"],
      "additionalProperties": true
    },
    "task": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the task"
        },
        "when": {
          "description": "Conditional execution"
        },
        "loop": {
          "description": "Loop over items"
        },
        "register": {
          "type": "string",
          "description": "Register result in variable"
        },
        "notify": {
          "description": "Notify handlers"
        },
        "tags": {
          "description": "Task tags"
        }
      },
      "additionalProperties": true
    },
    "hostPattern": {
      "type": "string",
      "description": "Ansible host pattern with common operators",
      "default": "all",
      "pattern": "^[a-zA-Z0-9_.*~:!&\\[\\],-]+$",
      "minLength": 1,
      "examples": [
        "all",
        "ungrouped",
        "localhost",
        "webservers",
        "webservers:dbservers",
        "webservers:&production",
        "webservers:!maintenance",
        "~(web|db).*\\.example\\.com",
        "webservers[0]",
        "webservers[0:2]",
        "webservers[1:]",
        "webservers[:3]",
        "*.example.com",
        "web*.example.com",
        "192.168.1.*"
      ]
    }
  }
}
